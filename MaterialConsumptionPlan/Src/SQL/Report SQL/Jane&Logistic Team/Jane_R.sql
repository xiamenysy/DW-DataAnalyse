--Date#:07/22/2014
--Material
SELECT ID,
  PLANT,
  MATERIAL,
  CATALOG_DASH,
  MAT_DESC,
  PROD_BU,
  PROD_FAM,
  MATL_TYPE,
  STRATEGY_GRP,
  MRP_TYPE,
  ULTIMATE_SOURCE
FROM INV_SAP_PP_OPT_X
WHERE PLANT = '5040';

SELECT 
  MVK_OPT.PLANT,
  MVK_OPT.SALES_ORG,
  MVK_OPT.MATERIALID,
  ISMC.CATALOG_STRING1 AS CATALOG_DASH,
  MVK_OPT.MAT_DESC,
  MVK_OPT.PROD_BU,
  MVK_OPT.MATL_TYPE_MTART,
  MVK_OPT.STRATEGY_GRP,
  MVK_OPT.MRP_TYPE,
  MVK_OPT.ULTIMATE_SOURCE
FROM
  (SELECT MVK.MATERIALID,
    MVK.SALES_ORG,
    OPT.PLANT,
    OPT.MAT_DESC,
    OPT.ULTIMATE_SOURCE,
    OPT.PROD_BU,
    OPT.MATL_TYPE_MTART,
    OPT.STRATEGY_GRP,
    OPT.MRP_TYPE
  FROM
    (SELECT MATERIALID,
      SALES_ORG
    FROM INV_SAP_PP_MVKE
    WHERE SALES_ORG    = '5003'
    AND CURRENT_SERIES = 'X'
    )MVK
  LEFT JOIN
    (SELECT MATERIALID,
      MAT_DESC,
      (PLANTID - 1) AS PLANT,
      SUBSTR(PROD_BU,0,3) AS PROD_BU,
      ULTIMATE_SOURCE,
      MATL_TYPE_MTART,
      STRATEGY_GRP,
      MRP_TYPE
    FROM INV_SAP_PP_OPTIMIZATION
    )OPT
  ON OPT.MATERIALID = MVK.MATERIALID
  )MVK_OPT
LEFT JOIN
  (SELECT CATALOG_STRING1,
    CATALOG_STRING2,
    MATERIALID
  FROM INV_SAP_NODASH_MAT_CATA
  )ISMC
ON ISMC.MATERIALID = MVK_OPT.MATERIALID;


SELECT MVK_OPT.MATERIALID,
  ISMC.CATALOG_STRING1 AS CATALOG_DASH,
  MVK_OPT.SALES_ORG,
  MVK_OPT.MAT_DESC,
      MVK_OPT.ULTIMATE_SOURCE,
      MVK_OPT.MATL_TYPE_MTART,
      MVK_OPT.STRATEGY_GRP,
      MVK_OPT.MRP_TYPE
FROM
  (SELECT MVK.MATERIALID,
    MVK.SALES_ORG,
    OPT.PLANT,
    OPT.MAT_DESC,
    OPT.ULTIMATE_SOURCE,
      OPT.MATL_TYPE_MTART,
      OPT.STRATEGY_GRP,
      OPT.MRP_TYPE
  FROM
    (SELECT MATERIALID,
      SALES_ORG
    FROM INV_SAP_PP_MVKE
    WHERE SALES_ORG    = '5003'
    AND CURRENT_SERIES = 'X'
    )MVK
  LEFT JOIN
    (SELECT MATERIALID,
      MAT_DESC,
      (PLANTID - 1) AS PLANT,
      ULTIMATE_SOURCE,
      MATL_TYPE_MTART,
      STRATEGY_GRP,
      MRP_TYPE
    FROM INV_SAP_PP_OPTIMIZATION
    )OPT
  ON OPT.MATERIALID = MVK.MATERIALID
  )MVK_OPT
LEFT JOIN
  (SELECT CATALOG_STRING1,
    CATALOG_STRING2,
    MATERIALID
  FROM INV_SAP_NODASH_MAT_CATA
  )ISMC
ON ISMC.MATERIALID = MVK_OPT.MATERIALID;

--STOCK
SELECT * FROM INV_SAP_BACKLOG_INV WHERE PLANT = '5040';
--PO/SO ITEM LIST
--PO
SELECT DISTINCT PO_ITEM.ID,
  PO_ITEM.PLANTID,
  PO_ITEM.MATERIALID,
  ITEM_BSC.CATALOG_DASH,
  ITEM_BSC.MAT_DESC,
  ITEM_BSC.PROD_BU,
  ITEM_BSC.PROD_FAM,
  ITEM_BSC.MATL_TYPE,
  ITEM_BSC.STRATEGY_GRP,
  ITEM_BSC.MRP_TYPE
FROM
  (SELECT MATERIALID
    ||'_'
    ||PLANTID AS ID,
    MATERIALID,
    PLANTID
  FROM INV_SAP_PP_PO_HISTORY
  WHERE PLANTID = '5040'
  )PO_ITEM
LEFT JOIN
  (SELECT ID,
    CATALOG_DASH,
    MAT_DESC,
    PROD_BU,
    PROD_FAM,
    MATL_TYPE,
    STRATEGY_GRP,
    MRP_TYPE
  FROM INV_SAP_PP_OPT_X
  )ITEM_BSC
ON ITEM_BSC.ID = PO_ITEM.ID;
--SO
SELECT DISTINCT SO_ITEM.ID,
  SO_ITEM.PLANTID,
  SO_ITEM.SALES_ORG,
  SO_ITEM.MATERIALID,
  ITEM_BSC.CATALOG_DASH,
  ITEM_BSC.MAT_DESC,
  ITEM_BSC.PROD_BU,
  ITEM_BSC.PROD_FAM,
  ITEM_BSC.MATL_TYPE,
  ITEM_BSC.STRATEGY_GRP,
  ITEM_BSC.MRP_TYPE
FROM
  (SELECT MATERIALID
    ||'_'
    ||PLANTID AS ID,
    MATERIALID,
    PLANTID,
    SALES_ORG
  FROM INV_SAP_SALES_HST
  WHERE SALES_ORG = '5003'
  )SO_ITEM
LEFT JOIN
  (SELECT ID,
    CATALOG_DASH,
    MAT_DESC,
    PROD_BU,
    PROD_FAM,
    MATL_TYPE,
    STRATEGY_GRP,
    MRP_TYPE
  FROM INV_SAP_PP_OPT_X
  )ITEM_BSC
ON ITEM_BSC.ID = SO_ITEM.ID;






SELECT *
FROM INV_SAP_PP_PO_HISTORY
WHERE PLANTID       = '5140'
AND LIFNR_VENDORNO                          IN ('V1180','V1090')
AND BUDATPOSTINGDATE BETWEEN TO_CHAR(SYSDATE - 60) AND TO_CHAR(SYSDATE);

SELECT DELI.DELIVERY,
  DELI.DELIVERY_ITEM,
  DELI.REFERENCE_DOC_TRIM,
  DELI.DELIVERY_CREATE_DATE,
  DELI.MATERIALID,
  DELI.PLANTID,
  DELI.ACT_GI_DATE,
  DELI.DELIVERY_QTY_SUOM,
  PO.BEDATSCHEDULELINEORDERDATE as PO_CREATE_DATE
  FROM
(
SELECT DELIVERY,
  DELIVERY_ITEM,
  REFERENCE_DOC_TRIM,
  CREATED_ON_DATE AS DELIVERY_CREATE_DATE,
  MATERIALID,
  PLANTID,
  ACT_GI_DATE,
  DELIVERY_QTY_SUOM
FROM INV_SAP_LIKP_LIPS_DAILY
WHERE REFERENCE_DOC_TRIM IN (SELECT DISTINCT EBELNPURCHDOCNO
  FROM INV_SAP_PP_PO_HISTORY
  WHERE PLANTID       = '5140')
AND ACT_GI_DATE BETWEEN TO_CHAR(SYSDATE - 60) AND TO_CHAR(SYSDATE) AND PLANTID IN ('1090','1180')
)DELI
LEFT JOIN
(
  SELECT EBELNPURCHDOCNO,BEDATSCHEDULELINEORDERDATE
  FROM INV_SAP_PP_PO_HISTORY
  WHERE PLANTID       = '5140'
)PO
ON PO.EBELNPURCHDOCNO = DELI.REFERENCE_DOC_TRIM;
