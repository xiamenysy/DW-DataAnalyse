--Date#:7/7/2014
--Author: Huang Moyue
--Increase DST stock in TWN
SELECT ID,
  LAST_REVIEW,
  MATERIAL,
  CATALOG_DASH,
  CATALOG_NO_DASH,
  PLANT,
  MAT_DESC,
  SAFETY_STOCK,
  UNIT,
  BU,
  STRATEGY_GRP,
  VENDOR_ITEM,
  MATL_TYPE,
  LEAD_TIME,
  PDT,
  AVG26_USAGE_QTY,
  FC_AVG13_WEEK_QTY,
  DELIVERY_QTY_SUOSUM
FROM
  (SELECT TOT.ID,
    TOT.LAST_REVIEW,
    TOT.MATERIAL,
    TOT.CATALOG_DASH,
    TOT.CATALOG_NO_DASH,
    TOT.PLANT,
    TOT.MAT_DESC,
    TOT.SAFETY_STOCK,
    TOT.UNIT,
    TOT.OH_QTY,
    TOT.PROC_TYPE,
    TOT.UNIT_COST,
    TOT.BU AS BU,
    TOT.STRATEGY_GRP,
    TOT.MRP_TYPE,
    TOT.MRP_CONTROLLER,
    TOT.PURCH_GROUP,
    TOT.VENDOR_ITEM,
    TOT.MATL_TYPE,
    TOT.MIN_INV,
    TOT.TARGET_INV,
    TOT.MAX_INV,
    TOT.LEAD_TIME,
    TOT.PDT,
    TOT.AVG26_USAGE_QTY,
    TOT.AVG13_USAGE_QTY,
    TOT.FC_AVG13_WEEK_QTY,
    DELI.DELIVERY_QTY_SUOSUM
  FROM
    (SELECT ITEM_BASIC_PP.ID,
      ITEM_BASIC_PP.LAST_REVIEW,
      ITEM_BASIC_PP.MATERIAL,
      ITEM_BASIC_PP.CATALOG_DASH,
      ITEM_BASIC_PP.CATALOG_NO_DASH,
      ITEM_BASIC_PP.PLANT,
      ITEM_BASIC_PP.MAT_DESC,
      ITEM_BASIC_PP.SAFETY_STOCK,
      ITEM_BASIC_PP.UNIT,
      ITEM_BASIC_PP.OH_QTY,
      ITEM_BASIC_PP.PROC_TYPE,
      ITEM_BASIC_PP.UNIT_COST,
      ITEM_BASIC_PP.BU AS BU,
      ITEM_BASIC_PP.STRATEGY_GRP,
      ITEM_BASIC_PP.MRP_TYPE,
      ITEM_BASIC_PP.MRP_CONTROLLER,
      ITEM_BASIC_PP.PURCH_GROUP,
      ITEM_BASIC_PP.VENDOR_ITEM,
      ITEM_BASIC_PP.MATL_TYPE,
      ITEM_BASIC_PP.MIN_INV,
      ITEM_BASIC_PP.TARGET_INV,
      ITEM_BASIC_PP.MAX_INV,
      ITEM_BASIC_PP.LEAD_TIME,
      ITEM_BASIC_PP.PDT,
      ITEM_BASIC_PP.AVG26_USAGE_QTY,
      ITEM_BASIC_PP.AVG13_USAGE_QTY,
      FC_AVG13_WEEK.FC_AVG13_WEEK_QTY
    FROM
      (SELECT ID,
        LAST_REVIEW,
        MATERIAL,
        CATALOG_DASH,
        CATALOG_NO_DASH,
        PLANT,
        MAT_DESC,
        SAFETY_STOCK,
        UNIT,
        PROC_TYPE,
        UNIT_COST,
        SUBSTR(PROD_BU,0,3) AS BU,
        STRATEGY_GRP,
        MRP_TYPE,
        MRP_CONTROLLER,
        PURCH_GROUP,
        VENDOR_ITEM,
        OH_QTY,
        MATL_TYPE,
        MIN_INV,
        TARGET_INV,
        MAX_INV,
        LEAD_TIME,
        PDT,
        AVG26_USAGE_QTY,
        AVG13_USAGE_QTY
      FROM VIEW_INV_SAP_PP_OPT_X
      )ITEM_BASIC_PP
    LEFT JOIN
      (SELECT MATERIALID
        ||'_'
        ||PLANTID                           AS ID,
        MATERIALID                          AS MATERIALID,
        PLANTID                             AS PLANTID,
        CEIL(SUM(PLNMG_PLANNEDQUANTITY)/13) AS FC_AVG13_WEEK_QTY
      FROM INV_SAP_PP_FRCST_PBIM_PBED
      WHERE (PDATU_DELIV_ORDFINISHDATE BETWEEN TO_CHAR(sysdate) AND TO_CHAR(sysdate + 91))
      AND VERSBP_VERSION = '55'
      GROUP BY MATERIALID,
        PLANTID
      )FC_AVG13_WEEK
    ON FC_AVG13_WEEK.ID = ITEM_BASIC_PP.ID
    )TOT
  LEFT JOIN
    (SELECT MATERIALID
      ||'_'
      ||PLANTID AS ID,
      MATERIALID,
      PLANTID,
      SUM(DELIVERY_QTY_SUOM) AS DELIVERY_QTY_SUOSUM
    FROM INV_SAP_LIKP_LIPS_DAILY
    WHERE CREATED_ON_DATE BETWEEN TO_CHAR(SYSDATE - 182) AND TO_CHAR(SYSDATE)
    GROUP BY MATERIALID,
      PLANTID
    )DELI
  ON DELI.ID = TOT.ID
  )
WHERE CATALOG_NO_DASH IN ('25BV2P5N104', '25BV4P8N104', '25BV6P0N104', '25BA2P5N104', '25BA4P8N104', '25BA8P0N104', '25BA011N104', '25BB2P5N104', '25BB5P0N104', '25BB8P0N104', '25BB011N104', '25BB017N104', '25BB024N104', '25BB032N104', '25BB048N104', '25BB062N104', '25BD1P4N104', '25BD2P3N104', '25BD2P3N114', '25BD4P0N104', '25BD6P0N104', '25BD010N104', '25BD013N104', '25BD017N104', '25BD024N104', '25BD030N104', '25BD037N114', '25BD043N114', '25BE0P9N104', '25BE1P7N104', '25BE3P0N104', '25BE4P2N104', '25BE6P6N104', '25BE9P9N104', '25BE012N104', '25BE019N104', '25BE022N104', '25BE027N104', '25BE032N104', '25AV1P6N104', '25AV2P5N104', '25AV4P8N104', '25AV6P0N104', '25AA1P6N104', '25AA2P5N104', '25AA4P8N104', '25AA8P0N104', '25AA011N104', '25AB1P6N104', '25AB2P5N104', '25AB5P0N104', '25AB8P0N104', '25AB011N104', '25AB017N104', '25AB024N104', '25AB032N104', '25AB048N104', '25AB062N104', '25AD1P4N104', '25AD2P3N104', '25AD4P0N104', '25AD6P0N104', '25AD010N104', '25AD013N104',
  '25AD017N104', '25AD024N104', '25AD030N114', '25AD037N114', '25AD043N114', '25AE0P9N104', '25AE1P7N104', '25AE3P0N104', '25AE4P2N104', '25AE6P6N104', '25AE9P9N104', '25AE012N104', '25AE019N104', '22FV1P6N103', '22FV2P5N103', '22FV4P5N103', '22FV6P0N103', '22FA1P6N103', '22FA2P5N103', '22FA4P2N103', '22FA8P0N103', '22FA011N103', '22FB1P6N103', '22FB2P5N103', '22FB4P2N103', '22FB8P0N103', '22FB012N103', '22FB017N103', '22FB025N104', '22FB033N104', '22FD1P5N103', '22FD2P5N103', '22FD4P2N103', '22FD6P0N103', '22FD8P7N103', '22FD013N104', '22FD018N104', '22FD024N104')
AND PLANT = '5110'; 


SELECT *
FROM VIEW_INV_SAP_BACKLOG_DB
WHERE CATALOG_DASH IN (
'22F-B025N104',
'25B-B017N104',
'25B-B8P0N104',
'25B-D024N104',
'25B-B011N104',
'22F-D6P0N103',
'25B-B032N104',
'25A-B032N104',
'22F-V4P5N103',
'22F-D1P5N103',
'22F-A4P2N103',
'25A-D017N104',
'25B-D4P0N104',
'25A-D024N104',
'22F-B2P5N103',
'25B-B024N104',
'25B-D1P4N104',
'25B-B5P0N104',
'25A-D010N104',
'25A-A4P8N104',
'22F-B033N104',
'25A-D043N114',
'25A-B017N104',
'25A-A8P0N104',
'22F-B017N103',
'22F-B8P0N103',
'25B-D013N104',
'25B-D6P0N104',
'25B-B062N104',
'25A-A2P5N104',
'25A-D037N114',
'25B-E1P7N104',
'25A-B2P5N104',
'25B-B2P5N104',
'25A-B5P0N104',
'22F-B1P6N103',
'25B-D030N104',
'22F-D013N104',
'25B-D043N114',
'25B-E0P9N104',
'22F-A011N103',
'22F-B012N103',
'25A-B011N104',
'25B-D037N114',
'25A-B024N104',
'25B-D2P3N104',
'25B-B048N104',
'25A-D2P3N104',
'25A-B8P0N104',
'25A-B1P6N104',
'25B-D2P3N114',
'25A-D013N104',
'22F-D2P5N103',
'22F-A2P5N103',
'22F-A8P0N103',
'25B-D017N104',
'25B-D010N104',
'22F-D4P2N103',
'25A-D1P4N104',
'22F-B4P2N103',
'25A-D4P0N104',
'22F-D018N104',
'25A-D6P0N104',
'25B-E032N104',
'25B-A2P5N104',
'25A-D030N114',
'22F-V1P6N103',
'25A-E3P0N104',
'25A-B048N104',
'25A-E1P7N104',
'25B-A8P0N104',
'25A-V2P5N104',
'25B-E022N104',
'22F-A1P6N103',
'25A-E9P9N104',
'22F-V6P0N103',
'25B-E019N104',
'25B-E9P9N104',
'25B-E012N104',
'25B-E3P0N104',
'25A-E4P2N104',
'22F-V2P5N103',
'25B-E6P6N104',
'25A-E019N104',
'25B-V2P5N104',
'25B-A4P8N104',
'25A-V6P0N104',
'25A-A1P6N104',
'25A-V4P8N104',
'25B-V6P0N104',
'25B-E4P2N104',
'25B-V4P8N104',
'25A-E6P6N104',
'22F-D024N104',
'25A-E0P9N104',
'25A-B062N104',
'25A-E012N104',
'22F-D8P7N103',
'25B-E027N104',
'25B-A011N104',
'25A-V1P6N104',
'25A-A011N104'
)AND PLANT = '5110';











SELECT MATERIALID,
        PLANTID,
        SUM(COMMITTEDQTY) AS OPEN_QTY
FROM INV_SAP_PP_PO_HISTORY
WHERE DELIVERYCOMPLETE IS NULL
AND MATERIALID         IN ( '22F-B025N104 A', 'PN-164045', 'PN-164038', 'PN-164063', 'PN-164041', '22F-D6P0N103 A', 'PN-164050', 'PN-204015', '22F-V4P5N103 A', '22F-D1P5N103 A', '22F-A4P2N103 A', 'PN-203863', 'PN-164057', 'PN-204017', '22F-B2P5N103 A', 'PN-164047', 'PN-164054', 'PN-164037', 'PN-203861', 'PN-203721', '22F-B033N104 A', 'PN-227805', 'PN-203736', 'PN-203722', '22F-B017N103 A', '22F-B8P0N103 A', 'PN-164060', 'PN-164058', 'PN-164053', 'PN-203720', 'PN-227803', 'PN-164077', 'PN-203731', 'PN-164036', 'PN-203732', '22F-B1P6N103 A', 'PN-164064', '22F-D013N104 A', 'PN-164075', 'PN-164076', '22F-A011N103 A', '22F-B012N103 A', 'PN-203735', 'PN-164074', 'PN-203738', 'PN-164055', 'PN-164052', 'PN-203858', 'PN-203734', 'PN-203730', 'PN-164066', 'PN-203862', '22F-D2P5N103 A', '22F-A2P5N103 A', '22F-A8P0N103 A', 'PN-164061', 'PN-164059', '22F-D4P2N103 A', 'PN-203857', '22F-B4P2N103 A', 'PN-203859', '22F-D018N104 A', 'PN-203860', 'PN-164091', 'PN-164022', 'PN-227802', '22F-V1P6N103 A',
  'PN-203873', 'PN-227789', 'PN-203872', 'PN-164027', 'PN-203716', 'PN-164088', '22F-A1P6N103 A', 'PN-203876', '22F-V6P0N103 A', 'PN-164087', 'PN-164083', 'PN-164086', 'PN-164078', 'PN-203874', '22F-V2P5N103 A', 'PN-164081', 'PN-204019', 'PN-163564', 'PN-164024', 'PN-203718', 'PN-203719', 'PN-203717', 'PN-164021', 'PN-164079', 'PN-164018', 'PN-203875', '22F-D024N104 A', 'PN-203871', 'PN-227796', 'PN-203877', '22F-D8P7N103 A', 'PN-164090', 'PN-164028', 'PN-203715', 'PN-203723' )
AND PLANTID = '5110'
GROUP BY MATERIALID,
  PLANTID;
      