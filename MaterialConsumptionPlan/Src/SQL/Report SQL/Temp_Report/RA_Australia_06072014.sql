-- Material (current series)
-- Unit cost at 5140
-- Strategy group at 5140
-- Safety stock at 5140
-- 26 week average Forecast at 5140
-- Vendor plant
-- Vendor strategy group
-- Vendor Safety stock
-- Vendor On--hand
-- Vendor 26 weeks usage
-- Vendor 26 week average requirement (forecast + STO demand)

SELECT * FROM 
(SELECT 
  ISPM.MATERIALID,
  ISPM.CURRENT_SERIES,
  ISMC.CATALOG_STRING1,
  ISMC.CATALOG_STRING2,
  DIRECT_SHIP_PLANT
FROM
  (SELECT MATERIALID,
    CURRENT_SERIES,
    DIRECT_SHIP_PLANT
  FROM INV_SAP_PP_MVKE
  WHERE CURRENT_SERIES = 'X'
  )ISPM
LEFT JOIN
  (SELECT MATERIALID,
   CATALOG_STRING1,
    CATALOG_STRING2
  FROM CATALOG_NODASH_MATERIAL WHERE CATALOG_STRING2 = '1756HPTIME'
  )ISMC
ON ISPM.MATERIALID = ISMC.MATERIALID)
WHERE CATALOG_STRING2 IN ('1756A17',
'1756PA75',
'1756PA75R',
'1756PSCA2',
'1756L73',
'1756L75',
'1756EN2T',
'1756DNB',
'1756RM',
'1756IB32',
'1756N2',
'1492RIFM40D24',
'1492CABLE025Z',
'1783MS10T',
'1783SFP1GSX',
'1783MX08S',
'1783SFP100LX',
'1756A7',
'1756OW16I',
'1492IFM40D24',
'1794AENT',
'1794IB16',
'1794OW8',
'1794IF8IH',
'1794OF8IH',
'1794TB3',
'1783MS06T',
'9355RSLETENE',
'9701VWSS000LENE',
'9701VWSCWAENE',
'9522VWP10RENE',
'9324RLD700NXENE',
'9324RLD300ENE',
'9324RLD000ENE',
'9518HAVENF',
'9701VWSTENE',
'9518HSE50K',
'9518HSEADV',
'9518HDLENF',
'9518HINSE2SE',
'9518HCAL50KENF',
'9518HPBENE',
'9521VPCL05ENE',
'9521VPHSCENE',
'9521VPSERVERENE',
'1756HIST2G',
'9515ASTSRVRENE',
'9515ASTCAP0500E',
'9515ASTDRROKENE',
'9309ENSH000ENF',
'9309ENSHCLTENF',
'9309ASTHLTHENF',
'9309IADSN000ENF',
'9309WEBCLTENF') AND DIRECT_SHIP_PLANT = '5140';

SELECT * FROM 
(SELECT 
  ISPM.MATERIALID,
  ISPM.CURRENT_SERIES,
  ISMC.CATALOG_STRING1,
  ISMC.CATALOG_STRING2,
  DIRECT_SHIP_PLANT
FROM
  (SELECT MATERIALID,
    CURRENT_SERIES,
    DIRECT_SHIP_PLANT
  FROM INV_SAP_PP_MVKE
  WHERE CURRENT_SERIES = 'X'
  )ISPM
LEFT JOIN
  (SELECT MATERIALID,
   CATALOG_STRING1,
    CATALOG_STRING2
  FROM CATALOG_NODASH_MATERIAL
  )ISMC
ON ISPM.MATERIALID = ISMC.MATERIALID)
WHERE CATALOG_STRING2 IN ('1756A17',
'1756PA75',
'1756PA75R',
'1756PSCA2',
'1756L73',
'1756L75',
'1756EN2T',
'1756DNB',
'1756RM',
'1756IB32',
'1756N2',
'1492RIFM40D24',
'1492CABLE025Z',
'1783MS10T',
'1783SFP1GSX',
'1783MX08S',
'1783SFP100LX',
'1756A7',
'1756OW16I',
'1492IFM40D24',
'1794AENT',
'1794IB16',
'1794OW8',
'1794IF8IH',
'1794OF8IH',
'1794TB3',
'1783MS06T',
'9355RSLETENE',
'9701VWSS000LENE',
'9701VWSCWAENE',
'9522VWP10RENE',
'9324RLD700NXENE',
'9324RLD300ENE',
'9324RLD000ENE',
'9518HAVENF',
'9701VWSTENE',
'9518HSE50K',
'9518HSEADV',
'9518HDLENF',
'9518HINSE2SE',
'9518HCAL50KENF',
'9518HPBENE',
'9521VPCL05ENE',
'9521VPHSCENE',
'9521VPSERVERENE',
'1756HIST2G',
'9515ASTSRVRENE',
'9515ASTCAP0500E',
'9515ASTDRROKENE',
'9309ENSH000ENF',
'9309ENSHCLTENF',
'9309ASTHLTHENF',
'9309IADSN000ENF',
'9309WEBCLTENF');


SELECT 
MATERIALID||'_'||PLANTID AS ID,
MATERIALID,
PLANTID,
SAFETY_STK,
UNIT_COST,
SUBSTR(PROD_BU,0,3) AS PROD_BU,
STRATEGY_GRP,
(GRT+PDT+1)AS LEAD_TIME,
MEINS_ISSUE_UOM,
MATERIALID||'_'||SUBSTR(VENDOR_NAME,0,4) AS VENDOR_ITEM  FROM DWQ$LIBRARIAN.INV_SAP_PP_OPTIMIZATION@ROCKWELL_DBLINK
WHERE MATERIALID IN ('1756-A17 B',
'1756-PA75 B',
'1756-PA75R A',
'1756-PSCA2 A',
'PN-114257',
'PN-114259',
'PN-184723',
'PN-91169',
'PN-66686',
'1756-IB32 B',
'1756-N2 B',
'1492-RIFM40D24 A',
'PN-199597',
'PN-16204',
'PN-27876',
'PN-189416',
'PN-27875',
'1756-A7 B',
'1756-OW16I A',
'1492-IFM40D24 A',
'1794-AENT B',
'1794-IB16 A',
'1794-OW8 A',
'PN-16749',
'PN-16732',
'1794-TB3 A',
'PN-16205',
'PN-C40631',
'PN-C41704',
'PN-C41694',
'PN-C41552',
'PN-101671',
'PN-C40446',
'PN-C40418',
'PN-C41371',
'PN-C41740',
'PN-153702',
'PN-153704',
'PN-C41377',
'PN-153705',
'PN-160243',
'PN-C41415',
'PN-C41319',
'PN-C41339',
'PN-134056',
'PN-49264',
'PN-C41354',
'PN-C41178',
'PN-C41350',
'PN-C40356',
'PN-C40285',
'PN-C40349',
'PN-C40296',
'PN-C40482') AND PLANTID = '5140';


--FC
SELECT MATERIALID
      ||'_'
      ||PLANTID                           AS ID,
      CEIL(SUM(PLNMG_PLANNEDQUANTITY)/26) AS FC_QTY_AVG_26WEEKS
    FROM DWQ$LIBRARIAN.INV_SAP_PP_FRCST_PBIM_PBED@ROCKWELL_DBLINK
    WHERE (PDATU_DELIV_ORDFINISHDATE BETWEEN TO_CHAR(sysdate) AND TO_CHAR(sysdate + 182))
    AND VERSBP_VERSION = '55' AND PLANTID = '5140'AND MATERIALID IN ('1756-A17 B',
'1756-PA75 B',
'1756-PA75R A',
'1756-PSCA2 A',
'PN-114257',
'PN-114259',
'PN-184723',
'PN-91169',
'PN-66686',
'1756-IB32 B',
'1756-N2 B',
'1492-RIFM40D24 A',
'PN-199597',
'PN-16204',
'PN-27876',
'PN-189416',
'PN-27875',
'1756-A7 B',
'1756-OW16I A',
'1492-IFM40D24 A',
'1794-AENT B',
'1794-IB16 A',
'1794-OW8 A',
'PN-16749',
'PN-16732',
'1794-TB3 A',
'PN-16205',
'PN-C40631',
'PN-C41704',
'PN-C41694',
'PN-C41552',
'PN-101671',
'PN-C40446',
'PN-C40418',
'PN-C41371',
'PN-C41740',
'PN-153702',
'PN-153704',
'PN-C41377',
'PN-153705',
'PN-160243',
'PN-C41415',
'PN-C41319',
'PN-C41339',
'PN-134056',
'PN-49264',
'PN-C41354',
'PN-C41178',
'PN-C41350',
'PN-C40356',
'PN-C40285',
'PN-C40349',
'PN-C40296',
'PN-C40482')
    GROUP BY MATERIALID, MATERIALID ||'_' ||PLANTID, PLANTID;




SELECT ID,
MATERIALID,
PLANTID,
SAFETY_STK,
OH_QTY,
UNIT_COST,
SUBSTR(PROD_BU,0,3) AS PROD_BU,
STRATEGY_GRP,
(GRT+PDT+1)AS VENDOR_LT,
MEINS_ISSUE_UOM
FROM
(SELECT 
MATERIALID||'_'||PLANTID AS ID,
PROC_TYPE,
MATERIALID,
PLANTID,
MAT_DESC,
SAFETY_STK,
LOT_SIZE,
OH_QTY,
UNIT_COST,
OH_$$,
MAX_INV_$$,
OH_WOS,
PLAN_INV_WOS,
PROD_BU,
PROD_FAM,
PROD_HIERARCHY,
MRP_CONTROLLER,
PURCH_GROUP,
STRATEGY_GRP,
MRP_TYPE,
SP_MATL_STAT_MMSTA,
SPC_PROC_KEY_SOBSL,
VENDOR_NAME,
LOT_ROUNDING_VALUE,
AVG52_USAGE_QTY,
STDEV52_USAGE,
AVG26_USAGE_QTY,
STDEV26_USAGE,
AVG13_USAGE_QTY,
STDEV13_USAGE,
Q1_LINES,
Q2_LINES,
Q3_LINES,
Q4_LINES,
Q1_FREQ_COUNT,
Q2_FREQ_COUNT,
Q3_FREQ_COUNT,
Q4_FREQ_COUNT,
(GRT+PDT+1)AS VENDOR_LT,
GRT,
PDT,
MEINS_ISSUE_UOM,
PURCH_GROUP_EKGRP,
MATL_TYPE_MTART FROM DWQ$LIBRARIAN.INV_SAP_PP_OPTIMIZATION@ROCKWELL_DBLINK)
WHERE ID IN (SELECT DISTINCT
MATERIALID||'_'||SUBSTR(VENDOR_NAME,0,4) AS VENDOR_ITEM
FROM DWQ$LIBRARIAN.INV_SAP_PP_OPTIMIZATION@ROCKWELL_DBLINK WHERE PLANTID = '5140'AND MATERIALID IN ('1756-A17 B',
'1756-PA75 B',
'1756-PA75R A',
'1756-PSCA2 A',
'PN-114257',
'PN-114259',
'PN-184723',
'PN-91169',
'PN-66686',
'1756-IB32 B',
'1756-N2 B',
'1492-RIFM40D24 A',
'PN-199597',
'PN-16204',
'PN-27876',
'PN-189416',
'PN-27875',
'1756-A7 B',
'1756-OW16I A',
'1492-IFM40D24 A',
'1794-AENT B',
'1794-IB16 A',
'1794-OW8 A',
'PN-16749',
'PN-16732',
'1794-TB3 A',
'PN-16205',
'PN-C40631',
'PN-C41704',
'PN-C41694',
'PN-C41552',
'PN-101671',
'PN-C40446',
'PN-C40418',
'PN-C41371',
'PN-C41740',
'PN-153702',
'PN-153704',
'PN-C41377',
'PN-153705',
'PN-160243',
'PN-C41415',
'PN-C41319',
'PN-C41339',
'PN-134056',
'PN-49264',
'PN-C41354',
'PN-C41178',
'PN-C41350',
'PN-C40356',
'PN-C40285',
'PN-C40349',
'PN-C40296',
'PN-C40482'));

-- Vendor 26 week average requirement (forecast + STO demand)
SELECT ID, MATERIALID,
  PLANTID,
  PO_SO_SA_FLAG,
STO_OPEN_QTY
FROM
(SELECT MATERIALID
  ||'_'
  ||PLANTID AS ID,
  MATERIALID,
  PLANTID,
  PO_SO_SA_FLAG,
  NVL(SUM(COMMITTEDQTY),0) AS STO_OPEN_QTY
FROM DWQ$LIBRARIAN.INV_SAP_PP_PO_HISTORY@ROCKWELL_DBLINK
WHERE PO_SO_SA_FLAG   = 'STO' AND MATERIALID IN ('PN-184700',
'PN-184801',
'PN-184715',
'PN-184820',
'PN-184691',
'PN-184718',
'PN-184714',
'PN-184795') AND PLANTID = '1090'
AND DELIVERYCOMPLETE IS NULL
GROUP BY MATERIALID
  ||'_'
  ||PLANTID,
  MATERIALID,
  PLANTID,
  PO_SO_SA_FLAG)
  where ID in ('PN-49264_1090',
'PN-16749_1090',
'PN-16204_1090',
'PN-16205_1090',
'PN-16732_1090',
'PN-189416_1090',
'PN-199597_1090',
'PN-114259_1090',
'1756-IB32 B_1090',
'PN-184723_1090',
'PN-114257_1090',
'PN-91169_1090',
'1756-OW16I A_1090',
'PN-66686_1090',
'1756-N2 B_1090',
'1492-RIFM40D24 A_1090',
'1492-IFM40D24 A_1090',
'1794-AENT B_1090',
'1794-TB3 A_1090',
'1794-IB16 A_1090',
'1794-OW8 A_1090',
'PN-27875_1090',
'PN-27876_1090',
'1756-PA75 B_1090',
'1756-PSCA2 A_1090',
'1756-PA75R A_1090',
'1756-A17 B_1180',
'1756-A7 B_1180'
);

SELECT *
FROM
  (SELECT MATERIALID
    ||'_'
    ||PLANTID                           AS ID,
    MATERIALID,
    CEIL(SUM(PLNMG_PLANNEDQUANTITY)/26) AS FC_QTY_AVG_26WEEKS
  FROM DWQ$LIBRARIAN.INV_SAP_PP_FRCST_PBIM_PBED@ROCKWELL_DBLINK
  WHERE (PDATU_DELIV_ORDFINISHDATE BETWEEN TO_CHAR(sysdate) AND TO_CHAR(sysdate + 182))
  AND VERSBP_VERSION = '55' AND MATERIALID IN ('PN-184700',
'PN-184801',
'PN-184715',
'PN-184820',
'PN-184691',
'PN-184718',
'PN-184714',
'PN-184795') AND PLANTID = '1090'
  GROUP BY MATERIALID ||'_' ||PLANTID, MATERIALID
  )
WHERE ID IN ('PN-49264_1090', 'PN-16749_1090', 'PN-16204_1090', 'PN-16205_1090', 'PN-16732_1090', 'PN-189416_1090', 'PN-199597_1090', 'PN-114259_1090', '1756-IB32 B_1090', 'PN-184723_1090', 'PN-114257_1090', 'PN-91169_1090', '1756-OW16I A_1090', 'PN-66686_1090', '1756-N2 B_1090', '1492-RIFM40D24 A_1090', '1492-IFM40D24 A_1090', '1794-AENT B_1090', '1794-TB3 A_1090', '1794-IB16 A_1090', '1794-OW8 A_1090', 'PN-27875_1090', 'PN-27876_1090', '1756-PA75 B_1090', '1756-PSCA2 A_1090', '1756-PA75R A_1090', '1756-A17 B_1180', '1756-A7 B_1180' ); 
    
    
    
    
    SELECT *
  FROM DWQ$LIBRARIAN.INV_SAP_PP_FRCST_PBIM_PBED@ROCKWELL_DBLINK
  WHERE (PDATU_DELIV_ORDFINISHDATE BETWEEN TO_CHAR(sysdate) AND TO_CHAR(sysdate + 182))
  AND VERSBP_VERSION = '55' AND MATERIALID = 'PN-184691' ('PN-184700',
'PN-184801',
'PN-184715',
'PN-184820',
'PN-184691',
'PN-184718',
'PN-184714',
'PN-184795') AND PLANTID = '1090'
  GROUP BY MATERIALID ||'_' ||PLANTID, MATERIALID
  
  
--26_avg
SELECT * FROM
(
SELECT 
MATERIALID||'_'||PLANTID AS ID,
PROC_TYPE,
MATERIALID,
PLANTID,
VENDOR_NAME,
LOT_ROUNDING_VALUE,
AVG52_USAGE_QTY,
STDEV52_USAGE,
AVG26_USAGE_QTY,
STDEV26_USAGE,
(GRT+PDT+1)AS VENDOR_LT,
GRT,
PDT,
MEINS_ISSUE_UOM,
PURCH_GROUP_EKGRP,
MATL_TYPE_MTART
FROM DWQ$LIBRARIAN.INV_SAP_PP_OPTIMIZATION@ROCKWELL_DBLINK) WHERE ID in ('PN-49264_1091',
'PN-16749_1091',
'PN-16204_1091',
'PN-16205_1091',
'PN-16732_1091',
'PN-189416_1091',
'PN-199597_1091',
'PN-114259_1091',
'1756-IB32 B_1091',
'PN-184723_1091',
'PN-114257_1091',
'PN-91169_1091',
'1756-OW16I A_1091',
'PN-66686_1091',
'1756-N2 B_1091',
'1492-RIFM40D24 A_1091',
'1492-IFM40D24 A_1091',
'1794-AENT B_1091',
'1794-TB3 A_1091',
'1794-IB16 A_1091',
'1794-OW8 A_1091',
'PN-27875_1091',
'PN-27876_1091',
'1756-PA75 B_1091',
'1756-PSCA2 A_1091',
'1756-PA75R A_1091',
'1756-A17 B_1181',
'1756-A7 B_1181'
);




SELECT 
MATERIALID||'_'||PLANTID AS ID,
MATERIALID,
PLANTID,
SAFETY_STK,
OH_QTY,
UNIT_COST,
STRATEGY_GRP,
(GRT+PDT+1)AS VENDOR_LT,
AVG26_USAGE_QTY
FROM DWQ$LIBRARIAN.INV_SAP_PP_OPTIMIZATION@ROCKWELL_DBLINK WHERE plantid = '1091' and MATERIALID IN ('PN-184700',
'PN-184801',
'PN-184715',
'PN-184820',
'PN-184691',
'PN-184718',
'PN-184714',
'PN-184795'
);